---
title: "Assessing methods to adjust for assay differences across COVID-19 serological surveillance studies in Canada"
execute: 
  echo: false
format:
  docx: 
    reference-doc: word-style-reference-manuscript.docx
  html: default
bibliography: bib.bib
csl: american-medical-association-brackets.csl
editor: visual
crossref: 
  thm-title: "Table"
  thm-prefix: "Table"
  cor-title: "Table S"
  cor-prefix: "Table S"
  lem-title: "Figure S"
  lem-prefix: "Figure S"
  fig-title: "**Figure**"
---

```{=html}
<!---

NOTES:
-   To render both word and HTML, can type this into terminal

quarto render 5_manuscript/manuscript.qmd

-   There are limits in cross-referencing in Quarto. The table
   Caption doesn't work well with flextable package, and 
  There's no option for secondary (supplemental) series of 
  tables or figures. As workaround, we repurpose other
  series.I'm using
        @thm- for tables (Table X)
        @cor- for supplemental tables (Table SX)
        @lem- for supplemental figures (Figure SX)
  The space between "S" and the number for supplemental figures seems unavoidable
   for now. Can manually correct before submitting to journal.
        
Flextable package isn't playing nicely with quarto for crossreferencing at the 
moment but it's being actively worked on. To install latest package version, use 
  devtools::install_github("davidgohel/flextable")

--->
```
Jiacheng Chen^1,2^, ..., W. Alton Russell^1,2^

<br>

^1^School of Population and Global Health, McGill University, Montreal, Canada

^2^COVID-19 Immunity Task Force

<br>

**Corresponding author:**

**Key words:**

**Running title:**

{{< pagebreak >}}

```{r setup, include=FALSE}
library(ggplot2) #plots
library(data.table) #for using datatables instead of frames
library(scales) #formatting plot legends and text
library(readxl) #read.excel
library(flextable) #generating tables
# library(ftExtra)
# library(officedown) #formatting for word
# library(officer)
# library(stringr)
theme_set(theme_bw())

```

```{r}
df_samp <- read_excel("../1_data/tables.xlsx", sheet = "sample")
```

# Abstract

**Background:** A

**Methods:** A

**Results:** A

**Conclusions:** A

{{< pagebreak >}}

# Introduction

Citation [@Langham2018a]. See @fig-sample, @cor-sample, @thm-sample, and @lem-sample.

The Covid-19 pandemic overview, global and what it looks like in Canada.

Serosurveillance programs in Canada, and its importance

Two types of antibodies to be detected by assays: Anti-S and Anti-N. Why we treated them differently in data analysis. Quantitative and qualitative test results.

anti-S (humoral response to infection or vaccination) and anti-N (marker of natural infection)

Waning of immunity against SARS-COV-2 after infection and immunization, indicated by decreasing blood Ab level overtime.

\[insert the figure of declining Ab with re-activation of immunization\]

Seropravalence and attack rate, why we need to employ RG equation or Bayesian model to estimated seropravalence, and why we also need models to adjust for waning immunity.

{{< pagebreak >}}

# Methods

**Notes**: Unlike the DBS vs VBS manuscript, the methods section of this project is mostly [unfinished]{.underline}. This section only shows the plan and the flow chart of the project in general, while the details of it needs constantly updating and polishing overtime, as the project goes. The potential obstacles were listed below:

-   AB Antenatal Data has not arrived yet.

-   In AB Outpatient Lab Data, they changed the assay (Diasorin S --\> Abbott S) in the midway, this would affect the validity of analysis based on quantitative test results, as the results from different assay are not directly comparable.

## Dataset

To estimate the SARS-CoV-2 seroprevalence and attack rate in Alberta, we used data from the Alberta Outpatient Lab (APL), Alberta Antenatal Testing, and Canadian Blood Services (CBS) datasets. CBS has tested \>450,000 blood donations for both SARS-CoV-2 anti-S and anti-N levels since March 2020. Data include donor's sex, self-reported race/ethnicity, and age. From their address, neighborhood material/social deprivation and urban/rural indicator have been derived. This analysis uses donations tested in Alberta (N=XX) only.

Alberta Health Services (AHS) tested \>160,000 Albertan outpatient labs (APL) and \>6,000 antenatal blood draws for anti-N and anti-S antibodies from June 2020 until December 2021. These data contain all the same variables as the blood donors except for race/ethnicity. Besides of serology test results and demographic data, CBS has linked the administrative data for the Alberta cohort (**is the linkage finished?**), which provided additional information on their hospitalizations, clinic visits, diagnoses, COVID vaccinations, and long-term disability claims. Similarly, AHS has completed a linkage in the Albertan outpatient lab (APL) data and Alberta Antenatal Blood Test data. We did not conduct analysis using a merged data, but instead, we conducted analysis separately for each data and presented the results in a unified graph (**Fig**. Y). **Table.X** below sumarrized the differences among three data utilized in the study. For more detail, see **Table. Z** in the result section.

**Table.X** Summary of difference among serosurveillance datasets from CBS and AHS

\[insert a table here\]

## **Seroprevalence and attack rate**

To evaluate the severity of Covid-19 pandemic overtime in Alberta province, first we calculated the anti-N assay test positivity. Then, to bridge the gap between test positivity and population-level seroprevalence, we employed the Rogen-Gladen (RG) equation and Bayesian models. Following seroprevalence estimation, we further estimated the attack rate while adjusting for waning immunity. These estimations are dessignated to answer what proportion of the Alberta population that has been infected by SARS-CoV-2. We presented both seroprevalence and attack rate in a unified graph (**Fig**. X), displaying changes over time on a four-month scale.

## **Proportion sufficiently protected:**

In evaluating whether participants possess immunity levels sufficient to shield them from future infections, from either vaccination or infection, we applied an age- and sex-adjusted threshold of protection to the quantitative Anti-S assay results. The threshold is cited from a valid source \[source of threshold\], indicating sufficient immunity against future SARS-CoV-2 infection. We also presented the fluctuation of the proportion sufficiently protected over time in another figure (**Fig.** Z), and we conducted sensitivity analyses in which we compare alternative threshold levels. The details of the project flowchart is presented in the **Fig**. Y below.

Fig.Y Project Flowchart

\[Insert the flowchart here\]

The gap between adjusted and unadjused - Rogen-Gladen equation is the cause

In our case, the sensitivity is where most variance come from. Specificity is good over time, and we can used the number published by the manufacturer (Roche & Abbott). Since sens is imperfect (0.8--1.0) and specificity is mostly 100% trustworthy (\~1.0), the R-G equation and be simplified as:

#### **True Prevalence = Observed Test Positivity/sens**

According to the equation above, the worse the sens (smaller in value), the larger the gap between the adjusted (blue) and unadjusted (red). The gap is larger among unadjusted lines (red).

Between data (APL, CBS, CANPATH) diff is not the major focus of this study, Yuan's paper will focus on those. For this paper, the major focus should be the difference between adjusting methods

<br>

# Results

**Table.Z** Difference among serosurveillance datasets from CBS and AHS

ANOVA test, p-values...

<br>

# Discussion

A

<br>

{{< pagebreak >}}

# Declarations

**Funding:** A

**Conflicts:** A

**Ethics/Consent:** A

**Data and materials:** A

**Code availability:** A

**Authors' contributions: A**

{{< pagebreak >}}

# References

::: {#refs}
:::

{{< pagebreak >}}

# Tables

::: {#thm-sample}
Table caption here.

```{r}
t_samp <- as_flextable(as_grouped_data(df_samp,
                                              groups = "subhead"))
t_samp <- compose(t_samp, i = ~ !is.na(subhead), j = "col1",
              value = as_paragraph(as_chunk(subhead)))
t_samp <- fontsize(t_samp, size = 10, part = "all")
t_samp <- font(t_samp, fontname = "Times", part = "all")
t_samp <- theme_box(t_samp)
t_samp <- bg(t_samp, bg = "#EAEAEA", part = "header")
t_samp <- width(t_samp, 1, 1.7)
t_samp <- bg(t_samp, i = c(1, 4), bg = "#DDDDDD", part = "body")
t_samp <- bold(t_samp, i = c(1, 4), part = "body")
t_samp <- align(t_samp, align = "left", part = "all")

t_samp
```
:::

{{< pagebreak >}}

# Figures

```{r}
#| label: fig-sample
#| fig-cap: "Figure caption here."

knitr::include_graphics("../4_output/figs/figure.png")

```

{{< pagebreak >}}

# Supplemental materials

<br>

# A. Supplement section

{{< pagebreak >}}

# Supplemental tables

::: {#cor-sample}
Table caption here.

```{r}
t_samp <- as_flextable(as_grouped_data(df_samp,
                                              groups = "subhead"))
t_samp <- compose(t_samp, i = ~ !is.na(subhead), j = "col1",
              value = as_paragraph(as_chunk(subhead)))
t_samp <- fontsize(t_samp, size = 10, part = "all")
t_samp <- font(t_samp, fontname = "Times", part = "all")
t_samp <- theme_box(t_samp)
t_samp <- bg(t_samp, bg = "#EAEAEA", part = "header")
t_samp <- width(t_samp, 1, 1.7)
t_samp <- bg(t_samp, i = c(1, 4), bg = "#DDDDDD", part = "body")
t_samp <- bold(t_samp, i = c(1, 4), part = "body")
t_samp <- align(t_samp, align = "left", part = "all")

t_samp
```
:::

{{< pagebreak >}}

# Supplemental figures

::: {#lem-sample}
Figure caption here.

```{r}
knitr::include_graphics("../4_output/figs/figure.png")
```
:::
