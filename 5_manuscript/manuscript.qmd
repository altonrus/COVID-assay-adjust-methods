---
title: "Assessing methods to adjust for assay differences across COVID-19 serological surveillance studies in Canada"
execute: 
  echo: false
format:
  docx: 
    reference-doc: word-style-reference-manuscript.docx
  html: default
bibliography: bib.bib
csl: american-medical-association-brackets.csl
editor: visual
crossref: 
  thm-title: "Table"
  thm-prefix: "Table"
  cor-title: "Table S"
  cor-prefix: "Table S"
  lem-title: "Figure S"
  lem-prefix: "Figure S"
  fig-title: "**Figure**"
---

```{=html}
<!---

NOTES:
-   To render both word and HTML, can type this into terminal

quarto render 5_manuscript/manuscript.qmd

-   There are limits in cross-referencing in Quarto. The table
   Caption doesn't work well with flextable package, and 
  There's no option for secondary (supplemental) series of 
  tables or figures. As workaround, we repurpose other
  series.I'm using
        @thm- for tables (Table X)
        @cor- for supplemental tables (Table SX)
        @lem- for supplemental figures (Figure SX)
  The space between "S" and the number for supplemental figures seems unavoidable
   for now. Can manually correct before submitting to journal.
        
Flextable package isn't playing nicely with quarto for crossreferencing at the 
moment but it's being actively worked on. To install latest package version, use 
  devtools::install_github("davidgohel/flextable")

--->
```
Jiacheng Chen^1,2^, ..., W. Alton Russell^1,2^

<br>

^1^School of Population and Global Health, McGill University, Montreal, Canada

^2^COVID-19 Immunity Task Force

<br>

**Corresponding author:**

**Key words:**

**Running title:**

{{< pagebreak >}}

```{r setup, include=FALSE}
library(ggplot2) #plots
library(data.table) #for using datatables instead of frames
library(scales) #formatting plot legends and text
library(readxl) #read.excel
library(flextable) #generating tables
# library(ftExtra)
# library(officedown) #formatting for word
# library(officer)
# library(stringr)
theme_set(theme_bw())

```

```{r}
df_samp <- read_excel("../1_data/tables.xlsx", sheet = "sample")
```

# Abstract

**Background:** A

**Methods:** A

**Results:** A

**Conclusions:** A

{{< pagebreak >}}

# Introduction

Citation [@Langham2018a]. See @fig-sample, @cor-sample, @thm-sample, and @lem-sample.

{{< pagebreak >}}

Two types of antibodies to be detected by assays: Anti-S and Anti-N:

anti-S (humoral response to infection or vaccination) and anti-N (marker of natural infection)

Waning of immunity against SARS-COV-2 after infection and immunization, indicated by decreasing blood Ab level overtime.

\[insert the figure of declining Ab with re-activation of immunization\]

# Methods

**Notes**: Unlike the DBS vs VBS manuscript, the methods section of this paper is mostly [unfinished]{.underline}. This section only shows the plan and the flow chart of the project in general, while the details of it needs constantly updating and polishing overtime, as the project goes. The potential obstacles were listed below:

-   AB Antenatal Data has not arrived yet.

-   In AB Outpatient Lab Data, they changed the assay (Diasorin S --\> Abbott S) in the midway, this would affect the validity of analysis based on quantitative test results, as the results from different assay are not directly comparable.

## Dataset

To estimate the seroprevalence and attack rate in Alberta, we used data from the Alberta Outpatient Lab (APL), Alberta Antenatal Testing, and Canadian Blood Services datasets. CBS has tested \>450,000 blood donations for both SARS-CoV-2 anti-S and anti-N levels since March 2020. Data include donor's sex, self-reported race/ethnicity, and age. From their address, neighborhood material/social deprivation and urban/rural indicator have been derived. This analysis uses donations tested in Alberta (N=XX) only.

Alberta Health Services (AHS) tested \>160,000 Albertan outpatient labs (APL) and \>6,000 antenatal blood draws for anti-N and anti-S antibodies from June 2020 until December 2021. These data contain all the same variables as the blood donors except for race/ethnicity. Besides of serology test results and demographic data, CBS has linked the administrative data for the Alberta cohort (**is the link finished?**), which provided additional on their hospitalizations, clinic visits, diagnoses, COVID vaccinations, and long-term disability claims. Similarly, AHS has completed a similar linkage in the Albertan outpatient lab (APL) data and Alberta Antenatal Blood Test data. See Table.X below for more details.

## **Seroprevalence and attack rate** 

To bridge the gap between test positivity and population-level seroprevalence, we will employ the Rogen-Gladen (RG) equation and Bayesian models. Following seroprevalence estimation, we will further estimate the attack rate while adjusting for waning immunity. These estimations will help to answer what proportion of the Alberta outpatient population that has been infected by SARS-CoV-2.

We presented both seroprevalence and attack rate in a unified graph (**Fig**. X), displaying changes over time on a four-month scale.

## **Proportion sufficiently protected:** 

In evaluating whether participants possess immunity levels sufficient to shield them from future infections, from either vaccination or infection, we will apply an age- and sex-adjusted threshold of protection to the quantitative Anti-S assay results. We will also present the fluctuation of the proportion sufficiently protected over time in another figure, and we will conduct sensitivity analyses in which we compare alternative threshold levels. The details of the project flowchart is presented in the **Fig**. Y below.

<br>

# Results

A

<br>

# Discussion

A

<br>

{{< pagebreak >}}

# Declarations

**Funding:** A

**Conflicts:** A

**Ethics/Consent:** A

**Data and materials:** A

**Code availability:** A

**Authors' contributions: A**

{{< pagebreak >}}

# References

::: {#refs}
:::

{{< pagebreak >}}

# Tables

::: {#thm-sample}
Table caption here.

```{r}
t_samp <- as_flextable(as_grouped_data(df_samp,
                                              groups = "subhead"))
t_samp <- compose(t_samp, i = ~ !is.na(subhead), j = "col1",
              value = as_paragraph(as_chunk(subhead)))
t_samp <- fontsize(t_samp, size = 10, part = "all")
t_samp <- font(t_samp, fontname = "Times", part = "all")
t_samp <- theme_box(t_samp)
t_samp <- bg(t_samp, bg = "#EAEAEA", part = "header")
t_samp <- width(t_samp, 1, 1.7)
t_samp <- bg(t_samp, i = c(1, 4), bg = "#DDDDDD", part = "body")
t_samp <- bold(t_samp, i = c(1, 4), part = "body")
t_samp <- align(t_samp, align = "left", part = "all")

t_samp
```
:::

{{< pagebreak >}}

# Figures

```{r}
#| label: fig-sample
#| fig-cap: "Figure caption here."

knitr::include_graphics("../4_output/figs/figure.png")

```

{{< pagebreak >}}

# Supplemental materials

<br>

# A. Supplement section

{{< pagebreak >}}

# Supplemental tables

::: {#cor-sample}
Table caption here.

```{r}
t_samp <- as_flextable(as_grouped_data(df_samp,
                                              groups = "subhead"))
t_samp <- compose(t_samp, i = ~ !is.na(subhead), j = "col1",
              value = as_paragraph(as_chunk(subhead)))
t_samp <- fontsize(t_samp, size = 10, part = "all")
t_samp <- font(t_samp, fontname = "Times", part = "all")
t_samp <- theme_box(t_samp)
t_samp <- bg(t_samp, bg = "#EAEAEA", part = "header")
t_samp <- width(t_samp, 1, 1.7)
t_samp <- bg(t_samp, i = c(1, 4), bg = "#DDDDDD", part = "body")
t_samp <- bold(t_samp, i = c(1, 4), part = "body")
t_samp <- align(t_samp, align = "left", part = "all")

t_samp
```
:::

{{< pagebreak >}}

# Supplemental figures

::: {#lem-sample}
Figure caption here.

```{r}
knitr::include_graphics("../4_output/figs/figure.png")
```
:::
